<!doctype html><html><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         neomutt setup
        
    </title><meta content="neomutt setup" property=og:title><link href=https://neuthral.github.io/fonts.css rel=stylesheet><script async data-goatcounter=https://neuthral.goatcounter.com/count src=https://neuthral.github.io/js/count.js></script><noscript><img src="https://neuthral.goatcounter.com//count?p=/posts/neomutt-setup/&t=neomutt setup"></noscript><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://neuthral.github.io/atom.xml rel=alternate title=neuthral.github.io type=application/atom+xml><link href=https://neuthral.github.io/theme/light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://neuthral.github.io/theme/dark.css rel=stylesheet><link href=https://neuthral.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://neuthral.github.io>neuthral.github.io</a><div class=socials><a class=social href=https://github.com/neuthral/ rel=me> <img alt=github src=/social_icons/github.svg> </a><a class=social href=https://github.com/neuthral/wiki rel=me> <img alt=wiki src=/social_icons/youtube.svg> </a><a class=social href=/rss.xml rel=me> <img alt=rss src=/social_icons/rss.svg> </a></div></div><nav><a href=/posts style=margin-left:.7em>/posts</a><a href=/projects style=margin-left:.7em>/projects</a><a href=/about style=margin-left:.7em>/about</a><a href=/other style=margin-left:.7em>/other</a></nav></header><main><article><div class=title><div class=page-header>neomutt setup<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2023-04-05</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#table-of-contents>Table of Contents</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#motivation>Motivation</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#neomutt>Neomutt</a> <ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#end-goal>End Goal</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#introduction-and-why>Introduction and WHY?</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#installation>Installation</a></li><ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#macos>macOS</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#arch-linux>Arch Linux</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#gentoo>Gentoo</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#ubuntu-and-wsl2-using-ubuntu>Ubuntu and WSL2 using Ubuntu</a></ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#running-neomutt-for-the-first-time>Running Neomutt for the first time</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#initial-mutt-configuration>Initial Mutt Configuration</a></li><ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#google-gmail-and-app-specific-passwords>Google, Gmail, and App-specific passwords</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#accessing-gmail-with-neomutt>Accessing Gmail with Neomutt</a></ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#mailboxes>Mailboxes</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#settings-i-highly-recommend>Settings I highly recommend</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#sidebar>Sidebar</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#signature>Signature</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#editor>Editor</a></li><ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#n-vim-and-mail>(N)vim and Mail</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#keybindings>Keybindings</a></ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#mailcap>Mailcap</a></ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#link-to-mailcap-file>link to mailcap file</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#open-attachments-with-mailcap-with>open attachments with mailcap with </a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#save-attachments-to-a-folder>save attachments to a folder</a> <ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#colors>Colors</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#external-programs>External programs</a></li><ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#urlscan>Urlscan</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#query>Query</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#encrypt>Encrypt</a></ul></ul><li><a href=https://neuthral.github.io/posts/neomutt-setup/#use-gpgme>Use GPGME</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#use-my-key-for-signing-and-encrypting>Use my key for signing and encrypting</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#use-gpgme-1>Use GPGME</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#automatically-sign-all-out-going-email>Automatically sign all out-going email</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#sign-replies-to-signed-emails>Sign replies to signed emails</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#encrypt-replies-to-encrypted-emails>Encrypt replies to encrypted emails</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#encrypt-and-sign-replies-to-encrypted-and-signed-email>Encrypt and sign replies to encrypted and signed email</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#attempt-to-verify-signatures-automatically>Attempt to verify signatures automatically</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#attempt-to-encrypt-automatically-if-possible>Attempt to encrypt automatically, if possible</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#i-would-recommend-setting-this-to-no-as-university-often-have-spam-filters>I would recommend setting this to no as university often have spam filters</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#and-this-will-cause-your-emails-to-be-marked-as-spam>And this will cause your emails to be marked as spam</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#as-they-can-t-decrypt-your-emails-lmao>as they can't decrypt your emails LMAO</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#so-you-can-view-encrypted-emails-automatically>So you can view encrypted emails automatically</a><li><a href=https://neuthral.github.io/posts/neomutt-setup/#conclusion>Conclusion</a></ul><section class=body><p>A Terminal Email Client As An Alternative To Gmail: The Old Dog Neomutt<p>![](https://seniormars.goatcounter.com//count?p=/posts/neomutt/&t=A Terminal Email Client As An Alternative To Gmail: The Old Dog Neomutt)<p>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}<p><a href=https://seniormars.github.io>SeniorMars</a><p><a href=https://github.com/seniormars/><img alt=github src=/social_icons/github.svg></a><a href=https://www.youtube.com/seniormarstries><img alt=youtube src=/social_icons/youtube.svg> </a><a href=/rss.xml><img alt=rss src=/social_icons/rss.svg></a><p><a href=/posts>/posts</a><a href=/projects>/projects</a><a href=/about>/about</a><a href=/other>/other</a><p>A Terminal Email Client As An Alternative To Gmail: The Old Dog Neomutt.<p>Posted on 2023-04-02<h1 id=table-of-contents>Table of Contents</h1><ul><li><p><a href=https://seniormars.github.io/posts/neomutt/#motivation>Motivation</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#neomutt>Neomutt</a></p> <ul><li><p><a href=https://seniormars.github.io/posts/neomutt/#end-goal>End Goal</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#introduction-and-why>Introduction and WHY?</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#installation>Installation</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#macos>macOS</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#arch-linux>Arch Linux</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#gentoo>Gentoo</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#ubuntu-and-wsl2-using-ubuntu>Ubuntu and WSL2 using Ubuntu</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#running-neomutt-for-the-first-time>Running Neomutt for the first time</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#initial-mutt-configuration>Initial Mutt Configuration</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#google-gmail-and-app-specific-passwords>Google, Gmail, and App-specific passwords</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#accessing-gmail-with-neomutt>Accessing Gmail with Neomutt</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#mailboxes>Mailboxes</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#settings-i-highly-recommend>Settings I highly recommend</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#sidebar>Sidebar</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#signature>Signature</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#editor>Editor</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#n-vim-and-mail>(N)vim and Mail</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#keybindings>Keybindings</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#mailcap>Mailcap</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#colors>Colors</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#external-programs>External programs</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#urlscan>Urlscan</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#query>Query</a></p><li><p><a href=https://seniormars.github.io/posts/neomutt/#encrypt>Encrypt</a></p></ul><li><p><a href=https://seniormars.github.io/posts/neomutt/#conclusion>Conclusion</a></p></ul><h1 id=motivation>Motivation</h1><p>In this day and age, every university pairs a student's email address with their administered Google suite platform. Typically, for most students, this default saves them a lot of trouble—that is, if you stay within the constraints of what your university considers “normal use”. For instance, if you want to use Google domains, Google cloud's APIs, or customize your Google security options, you are going to have a bad time. Don't get me wrong, I understand why some of these rules are forced upon students, but precisely because they are forced, I believe that there should be leeway for students that wish to opt out of the default settings. Now, this blog post won't teach how to petition your university to rid of Google, but it will teach you how to set up a terminal alternative to Gmail (most notably this blog is for college students that are forced to use Google's email platform).<p>Note:<p>This blog assumes basic terminal maturity<h1 id=neomutt>Neomutt</h1><h2 id=end-goal>End Goal</h2><p>Before I continue, I would like to show you what the result will look like:<p><img alt=Neomutt src=https://seniormars.github.io/posts/neomutt/neomutt0.png><p>Here is an image with an email open:<p><img alt=Neomutt src=https://seniormars.github.io/posts/neomutt/neomutt1.png><p>Finally, here is an image with a reply open (also <code>s/crack/cracked</code>): <img alt="Neomutt reply" src=https://seniormars.github.io/posts/neomutt/reply.png><p>At the end of this blog, I'll show the configuration we came up with.<h2 id=introduction-and-why>Introduction and WHY?</h2><p>Ok, you have seen the images, but now you wonder: 1) what am I looking at? And 2) why would I want to use this? Let's start with the first question. These images are of a terminal email client called Neomutt and it is my go-to email client. It supports all the basic email features that you would expect from an email client, plus way more! The second question is a bit more complex, as I cannot speak for everyone, but I will explain why I use Neomutt.<ul><li>Auto-image blocking: In the age where everyone is trying to get your attention, it is nice to have a client that doesn't render images by default. Instead of those annoying images, I get a plain view of the email, and concentrate on the content of the email.<li>Lightweight: Gmail is a resource hog. It takes seconds to load, and a pain to use when you have a slow internet connection. Neomutt loads in a fraction of a second and allows you filter through your emails quickly.<li>Configurable: Neomutt is extremely configurable. You can change the color scheme, the keybindings, and even the email client's behavior. For instance, In my current configuration, I have grammar checking, auto-completion for words, and auto-completion for email addresses. Everything is done through the keyboard.</ul><p>Now, if none of these reasons appeal to you, then Neomutt is not for you. Click the back button. But, if you are still here, then let's get started!<h2 id=installation>Installation</h2><p>For this blog, I'll be detailing the installation process for Arch Linux, Gentoo, Ubuntu, and macOS. Since I know these distributions extremely well, I can provide more detailed instructions. If you are using Windows, I recommend using WSL2, and you can follow along with the Ubuntu instructions.<h3 id=macos>macOS</h3><p>I'll be using Homebrew to install Neomutt:<p>Note: <code>$</code> is the prompt for a user without root access. You don't need to type it.<pre style=background:#0f1419;color:#bfbab0><code><span>$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
</span><span>$ # wait for the installation to finish and put homebrew in your path
</span><span>$ # ...
</span><span>$ brew install neomutt
</span><span>$ # additionally, I would recommend installing:
</span><span>$ brew install gnupg
</span><span>$ # I'll explain why later
</span></code></pre><h3 id=arch-linux>Arch Linux</h3><pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo pacman -Syu neomutt
</span><span>$ sudo pacman -Syu gnupg
</span><span>$ # or
</span><span>$ sudo paru -Syu neomutt
</span><span>$ sudo paru -Syu gnupg
</span></code></pre><h3 id=gentoo>Gentoo</h3><pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo emerge --ask mail-client/neomutt
</span><span>$ sudo emerge --ask app-crypt/gnupg
</span></code></pre><h3 id=ubuntu-and-wsl2-using-ubuntu>Ubuntu and WSL2 using Ubuntu</h3><pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo apt install neomutt
</span><span>$ sudo apt install gnupg
</span></code></pre><h2 id=running-neomutt-for-the-first-time>Running Neomutt for the first time</h2><p>The first time you run Neomutt, you will be greeted with a screen that looks like this that prompts you for your email address and password:<p><img alt=fresh src=https://seniormars.github.io/posts/neomutt/after_install.png><p>This is the default configuration that Neomutt comes with, but not very useful. We need to customize it first. To demonstrate how to configure Neomutt, I'll have two code blocks for each section. The first code block will be the configuration that I use, and the second code block is the one you should modify to fit your needs.<h2 id=initial-mutt-configuration>Initial Mutt Configuration</h2><p>We are going to take configuration step by step. I will explain what each section does, and why. The first we need to do is make a <code>muttrc</code> file. This file is where we will store all of our configuration. By default, Neomutt will look for a file called <code>muttrc</code> in the following location: <code>XDG_CONFIG_HOME/mutt/muttrc</code>.<p>Note:<p>XDG_CONFIG_HOME is an environment variable that points to the location of your configuration files.<p>Read more about it <a href=https://wiki.archlinux.org/title/XDG_Base_Directory>here</a>.<p>For example, on my machine, the location of my <code>muttrc</code> file is <code>~/.config/mutt/muttrc</code>.<p>If this file does not exist, then you can create it by running the following command:<pre style=background:#0f1419;color:#bfbab0><code><span>$ mkdir -p ~/.config/mutt
</span><span>$ touch ~/.config/mutt/muttrc
</span></code></pre><p>Let's put a hold on this to introduce the next section:<h3 id=google-gmail-and-app-specific-passwords>Google, Gmail, and App-specific passwords</h3><p>As I said before, this blog is intended for students that are forced to use Google's email platform. Which means I'll be detailing how to configure Neomutt to work with Gmail. Thus, before we move any further, it is important to get an "app-specific password" from Google.<p>Note:<p>An app-specific password is a password for applications that do not support 2-factor authentication or are considered "unsecure". Google wants you to use Gmail >:(<p>To get an app-specific password, follow these steps:<ul><li>Go to <a href=https://security.google.com/settings/security/apppasswords>Google's app-specific password page</a><li>Sign in with your Google account<li>Select “Mail” as the app or other and select “Other (custom name)” as the device. I use “Mutt” as the name.<li>Click “Generate” and copy the password that is generated. You will need this password later. Store it!<li>Profit??!!!</ul><p>Here is a screenshot of the result: <img alt="Google app password" src=https://seniormars.github.io/posts/neomutt/gpass.png><h3 id=accessing-gmail-with-neomutt>Accessing Gmail with Neomutt</h3><p>Now that we have an app-specific password, we can configure Neomutt to access Gmail. To accomplish this, let's open up our <code>muttrc</code> (i.e., <code>$EDITOR XDG_CONFIG_HOME/mutt/muttrc</code>) file with our favorite editor. I'll be using <code>nvim</code> for this blog, but you can use any editor you want. Now, let's add the following configuration to our <code>muttrc</code> file:<p>Mine:<pre style=background:#0f1419;color:#bfbab0><code><span># User
</span><span>set from = "[email protected]"
</span><span>set realname = "Charlie Cruz"
</span><span>
</span><span># Gmail
</span><span>set imap_user = "[email protected]"
</span><span>set smtp_url = "smtps://[email protected]@smtp.gmail.com:465/"
</span><span>set smtp_authenticators = 'gssapi:login'
</span><span>set imap_pass = "my_app_specific_password"
</span><span>set smtp_pass = "my_app_specific_password"
</span><span>
</span><span># Ensure TLS is enforced
</span><span>set ssl_starttls = yes
</span><span>set ssl_force_tls = yes
</span></code></pre><p>Yours:<pre style=background:#0f1419;color:#bfbab0><code><span># User
</span><span>set from = "your_email_address"
</span><span>set realname = "Your Name"
</span><span>
</span><span># Gmail
</span><span>set imap_user = "your_email_address"
</span><span>set smtp_url = "smtps://[email protected]:465/"
</span><span>set smtp_authenticators = 'gssapi:login'
</span><span>set imap_pass = "your_app_specific_password"
</span><span>set smtp_pass = "your_app_specific_password"
</span><span>
</span><span># Ensure TLS is enforced
</span><span>set ssl_starttls = yes
</span><span>set ssl_force_tls = yes
</span></code></pre><p>Note:<p>Plain text for passwords is a bad idea. See the encryption section of this blog.<p>Let's break down this section: First, it's pretty self-explanatory for the first few lines, but for <code>set smtp*</code>, we need to explain.<p><code>set smtp_url</code> is the URL that Neomutt will use to send emails. The format is as follows: <code>smtps://[[email protected]](/cdn-cgi/l/email-protection):port</code>. For Gmail, the server is <code>smtp.gmail.com</code> and the port is <code>465</code>. This is from the <a href="https://support.google.com/mail/answer/7126229?hl=en">Gmail SMTP server documentation</a>.<p><code>set smtp_authenticators</code> is the authentication method that Neomutt will use to send emails. For Gmail, we will use <code>gssapi:login</code> as the authentication method.<p><code>set imap_pass</code> and <code>set smtp_pass</code> are the passwords that Neomutt will use to access your email. Note this is plaintext, we will fix this later.<p><code>set ssl_starttls</code> and <code>set ssl_force_tls</code> are used to ensure that Neomutt uses TLS when connecting to the server. This is important because Gmail will not allow you to connect to the server without these properties.<p>After you have added this configuration to your <code>muttrc</code> file, save it, and in theory, you can now access your email! But, there are a few more things we need to do to make this more useful.<h2 id=mailboxes>Mailboxes</h2><p>The next step is to specify which mailboxes you want to access. To achieve this, we add:<pre style=background:#0f1419;color:#bfbab0><code><span># My mailboxes
</span><span>set folder = "imaps://imap.gmail.com:993/[Gmail]"
</span><span>set spoolfile = "+All Mail"
</span><span>set postponed = "+Drafts"
</span><span>set record = "+Sent Mail"
</span><span>set trash = "+Trash"
</span><span>
</span><span>mailboxes =Important =Starred =Drafts ="Sent Mail" =Spam =Trash
</span><span>
</span><span># Where to put the stuff
</span><span>set header_cache = "$XDG_CACHE_HOME/mutt/headers"
</span><span>set message_cachedir = "$XDG_CACHE_HOME/mutt/bodies"
</span><span>set certificate_file = "$XDG_CACHE_HOME/mutt/certificates"
</span><span>unset record
</span></code></pre><p>Let's break this down:<ul><li><code>set folder</code> is the folder that Neomutt will use to access your emails. 993 is just the port for imap.<li><code>set spoolfile</code> is your home inbox. This is the inbox that you see when you log into Gmail. You can change this to whatever you want. i.e., <code>set spoolfile = "+Important"</code>. I like to see all my emails, so I use <code>+All Mail</code>.<li><code>set postponed</code>, <code>set record</code>, and <code>set trash</code> are the folders that Neomutt will use to store emails that you have sent, drafts, and trash respectively in Gmail.<li><code>mailboxes</code> is a list of mailboxes that you want to access. You can add as many as you want, but I keep it simple with just the ones I use.<li><code>set header_cache</code> and <code>set message_cachedir</code> are the locations that Neomutt will use to cache your emails. This is important because it will make your email client much faster. <code>set certificate_file</code> is similar.<li><code>unset record</code> is used to disable the recording of sent emails. This is because Gmail already records sent emails, so we don't need to do it twice.</ul><p>At this point, you should be able to access your email! Now, let's make this even more useful.<h2 id=settings-i-highly-recommend>Settings I highly recommend</h2><p>Alright, so now that we have a basic configuration, but what about modifying how we reply to emails, or how we interact with our email client? Let's add the following to our <code>muttrc</code> file:<p>I added comments to explain what each line does.<pre style=background:#0f1419;color:#bfbab0><code><span># settings
</span><span>set pager_index_lines = 10          
</span><span>set pager_context = 3                # show 3 lines of context
</span><span>set pager_stop                       # stop at end of message
</span><span>set menu_scroll                      # scroll menu
</span><span>set tilde                            # use ~ to pad mutt
</span><span>set move=no                          # don't move messages when marking as read
</span><span>set mail_check = 30                  # check for new mail every 30 seconds
</span><span>set imap_keepalive = 900             # 15 minutes
</span><span>set sleep_time = 0                   # don't sleep when idle
</span><span>set wait_key = no		     # mutt won't ask "press key to continue"
</span><span>set envelope_from                    # which from?
</span><span>set edit_headers                     # show headers when composing
</span><span>set fast_reply                       # skip to compose when replying
</span><span>set askcc                            # ask for CC:
</span><span>set fcc_attach                       # save attachments with the body
</span><span>set forward_format = "Fwd: %s"       # format of subject when forwarding
</span><span>set forward_decode                   # decode when forwarding
</span><span>set forward_quote                    # include message in forwards
</span><span>set mime_forward                     # forward attachments as part of body
</span><span>set attribution = "On %d, %n wrote:" # format of quoting header
</span><span>set reply_to                         # reply to Reply to: field
</span><span>set reverse_name                     # reply as whomever it was to
</span><span>set include                          # include message in replies
</span><span>set text_flowed=yes                  # correct indentation for plain text
</span><span>unset sig_dashes                     # no dashes before sig
</span><span>unset markers
</span><span>
</span><span># Sort by newest conversation first.
</span><span>set charset = "utf-8"
</span><span>set uncollapse_jump
</span><span>set sort_re
</span><span>set sort = reverse-threads
</span><span>set sort_aux = last-date-received
</span><span># How we reply and quote emails.
</span><span>set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
</span><span>set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
</span><span>set send_charset = "utf-8:iso-8859-1:us-ascii" # send in utf-8
</span></code></pre><p>I highly recommend these settings, but you may want to change <code>askcc, edit_headers, fast_reply, envelope_from</code>.<h2 id=sidebar>Sidebar</h2><p>The sidebar is a very useful feature that allows you to see all your mailboxes in a sidebar. Here is a screenshot of what it looks like:<p><img alt=Sidebar src=https://seniormars.github.io/posts/neomutt/sidebar.png><p>Here is how to add it to your <code>muttrc</code> file:<pre style=background:#0f1419;color:#bfbab0><code><span>#sidebar
</span><span>set sidebar_visible # comment to disable sidebar by default
</span><span>set sidebar_short_path
</span><span>set sidebar_folder_indent
</span><span>set sidebar_format = "%B %* [%?N?%N / ?%S]"
</span><span>set mail_check_stats
</span><span>bind index,pager \CJ sidebar-prev
</span><span>bind index,pager \CK sidebar-next
</span><span>bind index,pager \CE sidebar-open
</span><span>bind index,pager B sidebar-toggle-visible
</span></code></pre><p>Now, you should be able to see the sidebar when you open your email client and press <code>&LTshift-b></code> to toggle it!<h2 id=signature>Signature</h2><p>The signature is the text that you add to the bottom of your emails. To add it to Neomutt, you need to:<ol><li><p>Create a file (call it <code>signature</code> or whatever you prefer)</p><li><p>Add your signature to the file. For example, here is mine:</p> <p>$ cat signature</p> <hr> <p>Charlie Cruz -- changing my legal name! Math & Linguistics @ Rice University '26</p><li><p>link the file to your <code>muttrc</code> file:</p> <p>set signature = "$XDG_CONFIG_HOME/mutt/signature"</p></ol><p>Now, when you send an email, your signature will be added to the bottom of the email.<h2 id=editor>Editor</h2><p>The editor is the program that you use to compose emails. By default, Neomutt uses <code>vi</code> as the editor, but you can change this to whatever you want. For instance, I use <code>nvim</code> as my editor, so I add the following to my <code>muttrc</code> file:<pre style=background:#0f1419;color:#bfbab0><code><span>set editor = "nvim"
</span></code></pre><p>Note:<p>In (Neo)Vim with patch 6e649224926b and partial 113cb513f76d now include mail.vim, which is a filetype plugin for mail. This plugin provides syntax highlighting, indentation, and other features for mail files.<h3 id=n-vim-and-mail>(N)vim and Mail</h3><p>If you use <code>nvim</code> as your editor, you may want to add the following to your <code>nvim/after/ftplugin/mail.{lua,vim}</code> file:<p>Lua:<pre style=background:#0f1419;color:#bfbab0><code><span>vim.opt_local.spell = true
</span><span>vim.opt_local.spelllang = 'en_us'
</span><span>vim.opt_local.fo:append('aw')
</span><span>local map = vim.api.nvim_buf_set_keymap
</span><span>local options = { noremap = true, silent = true}
</span><span>map(0, 'n', '&LTleader>x', 'ZZ', options)
</span></code></pre><p>Vim:<pre style=background:#0f1419;color:#bfbab0><code><span>setlocal spell
</span><span>setlocal spelllang=en_us
</span><span>setlocal fo+=aw
</span><span>nnoremap &LTleader>x ZZ
</span></code></pre><p>These settings will enable spell checking, better paragraph wrapping, and <code>&LTleader>x</code> will save and quit.<h3 id=keybindings>Keybindings</h3><p>I highly recommend adding the following keybindings to your <code>muttrc</code> file for more vim-like keybindings:<pre style=background:#0f1419;color:#bfbab0><code><span>macro index A \
</span><span>    "&LTtag-pattern>~N&LTenter>&LTtag-prefix>&LTclear-flag>N&LTuntag-pattern>.&LTenter>" \
</span><span>    "mark all new as read"
</span><span>
</span><span>bind index j next-entry
</span><span>bind index k previous-entry
</span><span>bind pager j next-line
</span><span>bind pager k previous-line
</span><span>
</span><span>bind attach,index,pager \CD next-page
</span><span>bind attach,index,pager \CU previous-page
</span><span>bind pager g top
</span><span>bind pager G bottom
</span><span>bind attach,index g first-entry
</span><span>bind attach,index G last-entry
</span></code></pre><p>The first marco isn't very vim-like, but it is very useful. It allows you to mark all new emails as read by pressing <code>A</code> in the index.<p>The next set of keybindings are for scrolling. I use <code>j</code> and <code>k</code> to scroll up and down, and <code>g</code> and <code>G</code> to go to the top and bottom of the page.<h2 id=mailcap>Mailcap</h2><p>The mailcap file is used to determine how to open attachments. For instance, if you have a <code>.pdf</code> file, you would want to open it with your prefer PDF viewer. This is most useful for rendering HTML in emails.<ol><li><p>Create a file called <code>mailcap</code> in your <code>$XDG_CONFIG_HOME/mutt</code> directory.</p><li><p>Add the following to the file:</p> <p>text/html; firefox %s; test=test -n "$display"; needsterminal; text/html; lynx -assume_charset=%{charset} -display_charset=utf-8 -dump -width=1024 %s; nametemplate=%s.html; copiousoutput; text/plain; cat %s; copiousoutput application/pdf; firefox %s; test=test -n "$display"; needsterminal;</p></ol><p>Of course, you can change the browser, and pdf viewer to whatever you want. On Mac, you might want <code>open -a firefox %s</code> or <code>open -a Preview %s</code>.<p>Note:<p>Firefox now supports editing PDFs!<ol start=3><li>Now install <code>lynx</code></ol><p>macOS<pre style=background:#0f1419;color:#bfbab0><code><span>$ brew install lynx
</span></code></pre><p>Arch Linux<pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo pacman -Syu lynx # or paru -Syu lynx
</span></code></pre><p>Gentoo<pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo emerge -av www-client/lynx
</span></code></pre><p>Ubuntu<pre style=background:#0f1419;color:#bfbab0><code><span>$ sudo apt install lynx
</span></code></pre><ol start=4><li><p>Link the file to your <code>muttrc</code> file and add the following to your <code>muttrc</code> file:</p> <h1 id=link-to-mailcap-file>link to mailcap file</h1> <p>set mailcap_path = "$XDG_CONFIG_HOME/mutt/mailcap"</p> <h1 id=open-attachments-with-mailcap-with>open attachments with mailcap with <return> <p>bind attach <return> view-mailcap <h1 id=save-attachments-to-a-folder>save attachments to a folder</h1> <p>macro attach s '<save-entry> <bol>~/Documents/attachments/<eol>' 'save attachment' auto_view text/html # automatically show html (mailcap uses lynx) <p>You can see more mailcap examples in my dotfiles <a href=https://github.com/SeniorMars/dotfiles/blob/master/.config/mutt/mailcap>here</a>.</p> <p>Now you should be able to open attachments with your prefered program and automatically render HTML in emails! NO PICTURES THOUGH :)</p> <h2 id=colors>Colors</h2> <p>You can change the colors of Neomutt by adding the following to your <code>muttrc</code> file:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>color status green default
</span><span># in general, the order is:
</span><span># color &LTelement> &LTcolor> &LTattr> optional&LTregex>
</span></code></pre> <p>My theme can be found <a href=https://github.com/SeniorMars/dotfiles/blob/master/.config/mutt/colors.muttrc>here</a>.</p> <h2 id=external-programs>External programs</h2> <p>While, Neomutt is a great email client, it is not perfect. For instance, it doesn't have a built-in query support, urls are not clickable, and it doesn't encrypt emails. To resolve these issues, we can use external programs.</p> <h3 id=urlscan>Urlscan</h3> <p>Let's take a look at the first issue: urls are not clickable. To fix this, we can use <code>urlscan</code> to make urls clickable.</p> <p>The GitHub repo for <code>urlscan</code> is <a href=https://github.com/firecat53/urlscan>here</a>, and you can install it via pip:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>$ pip install --user urlscan
</span></code></pre> <p>Now, we need to add the following to our <code>muttrc</code> file:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>macro index,pager \cb "&LTpipe-message> urlscan&LTEnter>" "call urlscan to extract URLs out of a message"
</span><span>macro attach,compose \cb "&LTpipe-entry> urlscan&LTEnter>" "call urlscan to extract URLs out of a message"
</span></code></pre> <p>Now, when you press <code>&LTCtrl+b></code> in the index or pager, <code>urlscan</code> will be called and the urls will be extracted. You can then press <code>&LTEnter></code> to open the url in your browser.</p> <p>See image below:</p> <p><img alt=Urls src=https://seniormars.github.io/posts/neomutt/urls.png></p> <h3 id=query>Query</h3> <p>The next issue is that Neomutt doesn't have a built-in query support. To fix this, we can use <code>goobook</code> to search our contacts or <code>lbdbq</code> to use apple's address book.</p> <p>For goobook, I recommend looking at archlinux's <a href=https://wiki.archlinux.org/title/Mutt#Goobook>wiki</a> for more information. It basically comes down to getting a token from Google.</p> <p>Since, I currently use macOS, I will show you how to use <code>lbdbq</code> to search my contacts.</p> <ol><li><p>Install <code>lbdbq</code>:</p> <p>$ brew install lbdbq</p><li><p>Modify <code>lbdbq</code>'s config file (either <code>$HOME/.lbdbrc</code> or <code>/opt/homebrew/Cellar/lbdb/0.51.1/etc/lbdb.rc</code>) to include the following:</p> <p>METHODS="m_inmail m_osx_addressbook m_muttalias"</p></ol> <p>You are done!</p> <ol start=3><li><p>Add the following to your <code>muttrc</code> file:</p> <p>set query_command="/opt/homebrew/bin/lbdbq '%s'" bind editor <tab> complete-query <p>Now, when you press <code>&LTTab></code> in the editor when prompted for an email, you will be able to search your MacBook contacts!</p> <p>Note:</p> <p>You can add your Google contacts to your MacBook contacts by linking your Google account to your MacBook contacts. Which is not great, but I still did it.</p> <h3 id=encrypt>Encrypt</h3> <p>I use <code>gpg</code> to encrypt my emails. This is very useful for GitHub, and other services that require security. This is especially useful on mailing lists where you need to verify information. I find that everyone in the Arch Linux Mailing list uses it!</p> <ol><li><p>We already installed <code>gpg</code> in the beginning, so we are good to go!</p><li><p>Create a key and follow the instructions that are prompted:</p> <p>$ gpg --full-generate-key</p><li><p>Copy your public key:</p> <p>$ gpg --list-secret-keys --keyid-format=long</p></ol> <p>For instance, my public key is: <code>7C668A6D13D5729989FB126B183357B41320BB2B</code>. You can see the full version here: <a href=https://github.com/SeniorMars.gpg>https://github.com/SeniorMars.gpg</a></p> <ol start=4><li><p>Add the following to your <code>muttrc</code> file:</p> <h1 id=use-gpgme>Use GPGME</h1> <h1 id=use-my-key-for-signing-and-encrypting>Use my key for signing and encrypting</h1> <p>set pgp_default_key = 7C668A6D13D5729989FB126B183357B41320BB2B</p> <h1 id=use-gpgme-1>Use GPGME</h1> <p>set crypt_use_gpgme = yes</p> <h1 id=automatically-sign-all-out-going-email>Automatically sign all out-going email</h1> <p>set crypt_autosign = yes</p> <h1 id=sign-replies-to-signed-emails>Sign replies to signed emails</h1> <p>set crypt_replysign = yes</p> <h1 id=encrypt-replies-to-encrypted-emails>Encrypt replies to encrypted emails</h1> <p>set crypt_replyencrypt = yes</p> <h1 id=encrypt-and-sign-replies-to-encrypted-and-signed-email>Encrypt and sign replies to encrypted and signed email</h1> <p>set crypt_replysignencrypted = yes</p> <h1 id=attempt-to-verify-signatures-automatically>Attempt to verify signatures automatically</h1> <p>set crypt_verify_sig = yes</p> <h1 id=attempt-to-encrypt-automatically-if-possible>Attempt to encrypt automatically, if possible</h1> <h1 id=i-would-recommend-setting-this-to-no-as-university-often-have-spam-filters>I would recommend setting this to no as university often have spam filters</h1> <h1 id=and-this-will-cause-your-emails-to-be-marked-as-spam>And this will cause your emails to be marked as spam</h1> <h1 id=as-they-can-t-decrypt-your-emails-lmao>as they can't decrypt your emails LMAO</h1> <p>set crypt_opportunistic_encrypt = no</p> <h1 id=so-you-can-view-encrypted-emails-automatically>So you can view encrypted emails automatically</h1> <p>auto_view application/pgp-encrypted</p><li><p>Plaintext is a bad idea, which is why we are going to use GPG to encrypt our passwords.</p></ol> <p>In your <code>muttrc</code> delete the following lines:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>set imap_pass = "my_app_specific_password"
</span><span>set smtp_pass = "my_app_specific_password"
</span></code></pre> <p>Now go to your terminal and create a file called <code>passwords</code> in your <code>muttrc</code> directory and add the lines you just deleted. Now, encrypt the file:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>$ gpg --encrypt --sign  -r YOUR_GPG_KEY passwords
</span></code></pre> <p>You should end up with a file called <code>passwords.gpg</code> in your <code>muttrc</code> directory.</p> <p>Now, add the following to your <code>muttrc</code> file:</p> <pre style=background:#0f1419;color:#bfbab0><code><span>source "gpg -dq $XDG_CONFIG_HOME/passwords.gpg |"
</span></code></pre> <p>Remove the plaintext <code>passwords</code> file.</p> <pre style=background:#0f1419;color:#bfbab0><code><span>$ shred -u passwords
</span></code></pre> <p>Now, you have encrypted your passwords!</p> <p>Image below (notice the <code>Good signature</code> and <code>The following data is signed</code>): <img alt=GPG src=https://seniormars.github.io/posts/neomutt/gpg.png></p> <p>And that's it! You should now have a fully functional email client!</p> <h1 id=conclusion>Conclusion</h1> <p>I hope you enjoyed this tutorial! If you have any questions, don't ask /s.</p> <p>I am going to upload a talk I gave on setting up Neovim for non-programmers soon. This talks about grammar checking, spell keybinds, and more. So stay tuned!</p> <p>Thanks for reading and have a nice day!</p> <p>SeniorMars</p> 